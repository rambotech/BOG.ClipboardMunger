<?xml version="1.0"?>
<ClipboardMungerScriptContainer xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Title>JSON-it</Title>
  <Description>Assumes the clipboard contains one or more lines, with each line containing tab-separated items.  The first line defines field names, while the remaining lines define the values for the fields.

Transforms the content into a JSON block of data, as follows:

[
  {
    "column1": "columnvalue1",
    "column2": "columnvalue2",
   ...
    "columnX": "columnvalueX"
  },
...
  {
    "column1": "columnvalue1",
    "column2": "columnvalue2",
    ....
    "columnX": "columnvalueX"
  }
]


</Description>
  <Script>// Change the TSV clipboard content to a JSON document
// Assumes first line contains headers for the column data in the rows below.

using System;
using System.Collections.Generic;
using System.Text;
using System.Web;
using System.Windows.Forms;
using BOG.Framework;

public class Script : Interfaces.IClipboard
{
	private string C_EncodedString (string source)
	{
		StringBuilder result = new StringBuilder();
		for (int i = 0; i &lt; source.Length; i++)
		{
			string test = source.Substring(i,1);
			if (test == "\\") {
				result.Append ("\\\\");
			} else if (test == "\"") {
				result.Append ("\\\"");
			} else if (test == "/") {
				result.Append ("\\/");
			} else if (test == "\x08") {
				result.Append ("\\b");
			} else if (test == "\x0c") {
				result.Append ("\\f");
			} else if (test == "\x0d") {
				result.Append ("\\r");
			} else if (test == "\x0a") {
				result.Append ("\\n");
			} else if (test == "\x09") {
				result.Append ("\\t");
			} else
				result.Append (test);
		}
		return result.ToString();
	}
	
	public string Munge (string clipboardSource)
	{
		StringBuilder result = new StringBuilder();
        int LineIndex = 0;
        Dictionary&lt;int, string&gt; DataIndex = new Dictionary&lt;int, string&gt; ();
		result.AppendLine ("[");

		if (clipboardSource.Length &gt; 0)
		{
			foreach (string ThisLine in clipboardSource.Split(new string[] { "\r\n" }, StringSplitOptions.RemoveEmptyEntries))
			{
				if (string.IsNullOrEmpty (ThisLine)) continue;
				LineIndex++;
				string[] ColumnData = ThisLine.Split (new char[] { '\t' }, StringSplitOptions.None);
				if (LineIndex &gt; 1)
				{
					if (LineIndex &gt; 2)
					{
						result.AppendLine(",");
					}
					result.AppendLine ("  {");
				}
				for (int ColumnIndex = 0; ColumnIndex &lt; ColumnData.Length; ColumnIndex++)
				{
					if (LineIndex == 1)
					{
						// for the header line, populate the column names for use as column tags.
						DataIndex.Add(ColumnIndex, ColumnData[ColumnIndex].Trim());
						continue;
					}
					if (ColumnIndex &gt; 0) {
						result.AppendLine (",");
					}
					result.Append (string.Format("    \"{0}\": \"{1}\"", 
						C_EncodedString(DataIndex[ColumnIndex]),
						C_EncodedString(ColumnData[ColumnIndex])));
				}
				if (LineIndex &gt; 1)
				{
					result.AppendLine();
					result.Append("  }");
				}
	    	}
	    }
		result.AppendLine();
		result.AppendLine ("]");
		return result.ToString();
	}
}
</Script>
  <Language>1</Language>
  <TestData>Date	Source	Ta"rget	Deduct	Amount	Quan\tity
12/8/2015	Max47	Floor1	yes	$34.72	
12/9/2015	Max43	Floor\3		$0.00	14
12/10/2015	Max39	Floor5	yes	$88.40	
12/11/2015	Max35	Fl"oor7	yes	$56.72	23
12/12/2015	Max31	Floor9		$34.72	
12/13/2015	Max27	Floor11	yes	$0.00	
12/14/2015	Max23	Floor13	yes	$88.40	-47
12/15/2015	Max19	Floor15	yes	$56.72	
12/16/2015	Max15	Floor17		$34.72	
12/17/2015	Max11	Floor19	yes	$0.00	
12/18/2015	Max07	Floor21	yes	$88.40	
12/19/2015	Max03	Floor23		$56.72	
12/20/2015	Max01	Floor25		$34.72	
12/21/2015	Max05	Floor27	yes	$0.00	
12/22/2015	Max09	Floor29	yes	$88.40	
12/23/2015	Max13	Floor31		$56.72	
12/24/2015	Max17	Floor33		$55.11	</TestData>
  <References>
    <string>System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</string>
    <string>System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a</string>
    <string>System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a</string>
    <string>System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</string>
  </References>
  <OtherReferences>
    <string>C:\apps\Clipboard Munger\Framework.DLL</string>
  </OtherReferences>
</ClipboardMungerScriptContainer>